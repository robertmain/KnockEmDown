<!DOCTYPE html>
<html>
	<head>
		<title>{{packageFile.name}} | Presenter Remote</title>
		<script src="/socket.io/socket.io.js"></script>
		 <meta content="width=device-width, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no" name="viewport" />
		<link href="css/remote.css" rel="stylesheet" media="screen">
		<script src="js/jquery-2.0.3.min.js"></script>
		<script src="js/bootstrap.min.js"></script>
		<script>
			var socket;
			setTimeout(function(){
				socket = io.connect();
				socket.on('auth_challenge', function(){
					$('.splash').addClass('hide');
					$('.pincode').removeClass('hide');
					$('.remote').addClass('hide');
				});

				socket.on('auth_success', function(){
					$('.splash').addClass('hide');
					$('.pincode').removeClass('hide');
					$('.remote').addClass('hide');

					$(document).keyup(function(e){
						var code = (e.keyCode ? e.keyCode : e.which);				
						//Blackout
		 				if(code == 66){
							socket.emit('toggle_blackout');
						}
						//Next Slide
						else if(code == 39){
							socket.emit('next_slide');
						}
						//Previous Slide
						else if(code == 37){
							socket.emit('prev_slide');
						}
					});
				});

				socket.on('auth_fail', function(){
					$('.splash').addClass('hide');
					$('.remote').addClass('hide');
					$('.pincode').removeClass('hide');
					
					//Go to pin screen [done]
					//Display error [in progress]
					//Hit Stewart [pending]
				});

				socket.on('state', function(state){
					$('span.current-slide').text(state.currentSlide);
					if(state.blackout){
						$('.btn-inverse').addClass('active');
					}
					else{
						$('.btn-inverse').removeClass('active');
					}
				});

			}, 500);
		</script>
	</head>

	<body>
		<div class="splash">
			<h1>LOADING</h1>
		</div>
		<div class="remote hide">
			<nav class="navbar navbar-inverse navbar-default navbar-fixed-top" role="navigation">
				<div class="navbar-header">
					<button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
						<span class="icon-bar"></span>
						<span class="icon-bar"></span>
						<span class="icon-bar"></span>
					</button>
					<p class="navbar-brand" href="#">{{packageFile.name}}</p>
				</div>
				<div class="collapse navbar-collapse navbar-ex1-collapse">
					<form class="navbar-form navbar-left">
						<div class="input-group">
							<input type="number" class="form-control slide-jump-input" />
							<span class="input-group-btn">
								<button class="btn slide-jump-button" role="button">Go</button>
							</span>
						</div>
					</form>
				</div>
			</nav>
			<div class="container">
				<div class="row">
					<div class="col-xs-12">
						<button class="btn btn-inverse btn-lg col-xs-12" data-action="blackout">Blackout</button>
					</div>
				</div>
				<div class="row">
					<div class="col-xs-12">
						<p class="text-center slide-indicator">Slide <span class="current-slide"></span> of {{parsedSlides.length}}</p>
					</div>
				</div>
				<div class="row">
					<div class="col-xs-6">
						<button class="btn btn-lg btn-warning col-xs-12" data-action="previous">Previous</button>
					</div>
					<div class="col-xs-6">
						<button class="btn btn-lg btn-success col-xs-12" data-action="next">Next</button>
					</div>
				</div>
			</div>
		</div>
		<div class="pincode hide">
			<h2>Authentication Required</h2>
			<form>
				<div class="form-group">
					<input type="text" class="form-control input-lg" placeholder="Presentation Pin" />
				</div>
				<div class="form-group">
					<button type="button" id="pincode-btn" class="btn btn-primary btn-lg btn-block">Submit Pin</button>
				</div>
			</form>
		</div>
		<script>
			$('button[data-action="next"]').click(function(){
				socket.emit('next_slide');
			});

			$('button[data-action="previous"]').click(function(){
				socket.emit('prev_slide');
			});

			$('button[data-action="blackout"]').click(function(){
				socket.emit('toggle_blackout');
			});

			$('form').click(function(event){
				return false;
			});

			$('button.slide-jump-button').click(function(event){
				socket.emit('goto_slide', parseInt($('.slide-jump-input').val()));
				$('.slide-jump-input').val("");
				event.preventDefault();
			});

			$('#pincode-btn').click(function(){
				if($('#pincode-field')){
					socket.emit('auth', {'password': $('#pincode-field').val()});
				}
			});
		</script>
	</body>
</html>